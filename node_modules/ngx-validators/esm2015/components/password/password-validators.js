/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { AbstractControlUtil } from './../abstract-control-util';
// tslint:disable-next-line:variable-name
export class PasswordValidators {
    /**
     * @param {?} repeatCount
     * @return {?}
     */
    static repeatCharacterRegexRule(repeatCount) {
        /** @type {?} */
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            /** @type {?} */
            let repeatDec = repeatCount - 1;
            /** @type {?} */
            let pattern = '([^\\x00-\\x1F])\\1{' + repeatDec + '}';
            if (control.value !== '' && new RegExp(pattern).test(control.value)) {
                return { 'repeatCharacterRegexRule': { 'repeatCount': repeatCount } };
            }
            return undefined;
        };
        return validator;
    }
    ;
    /**
     * @param {?} allowedChars
     * @return {?}
     */
    static allowedCharacterRule(allowedChars) {
        /** @type {?} */
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            /** @type {?} */
            let value = control.value;
            /** @type {?} */
            let valid = true;
            /** @type {?} */
            let invalidChars = [];
            for (let char of value) {
                if (allowedChars.indexOf(char) === -1) {
                    valid = false;
                    if (invalidChars.indexOf(char) === -1) {
                        invalidChars.push(char);
                    }
                }
            }
            if (!valid) {
                return { 'allowedCharacterRule': { 'invalidChars': invalidChars, 'allowedChars': allowedChars } };
            }
            return undefined;
        };
        return validator;
    }
    ;
    /**
     * @param {?} amount
     * @return {?}
     */
    static alphabeticalCharacterRule(amount) {
        /** @type {?} */
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            /** @type {?} */
            let value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            /** @type {?} */
            let pattern = /[^A-Za-z]+/g;
            /** @type {?} */
            let stripped = value.replace(pattern, '');
            if (stripped.length < amount) {
                return { 'alphabeticalCharacterRule': { 'required': amount, 'actual': stripped.length } };
            }
            return undefined;
        };
        return validator;
    }
    ;
    /**
     * @param {?} amount
     * @return {?}
     */
    static digitCharacterRule(amount) {
        /** @type {?} */
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            /** @type {?} */
            let value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            /** @type {?} */
            let pattern = /[^0-9\.]+/g;
            /** @type {?} */
            let stripped = value.replace(pattern, '');
            if (stripped.length < amount) {
                return { 'digitCharacterRule': { 'required': amount, 'actual': stripped.length } };
            }
            return undefined;
        };
        return validator;
    }
    ;
    /**
     * @param {?} amount
     * @return {?}
     */
    static lowercaseCharacterRule(amount) {
        /** @type {?} */
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            /** @type {?} */
            let value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            /** @type {?} */
            let pattern = /[^a-z]+/g;
            /** @type {?} */
            let stripped = value.replace(pattern, '');
            if (stripped.length < amount) {
                return { 'lowercaseCharacterRule': { 'required': amount, 'actual': stripped.length } };
            }
            return undefined;
        };
        return validator;
    }
    ;
    /**
     * @param {?} amount
     * @return {?}
     */
    static uppercaseCharacterRule(amount) {
        /** @type {?} */
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            /** @type {?} */
            let value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            /** @type {?} */
            let pattern = /[^A-Z]+/g;
            /** @type {?} */
            let stripped = value.replace(pattern, '');
            if (stripped.length < amount) {
                return { 'uppercaseCharacterRule': { 'required': amount, 'actual': stripped.length } };
            }
            return undefined;
        };
        return validator;
    }
    ;
    /**
     * @param {?} amount
     * @return {?}
     */
    static specialCharacterRule(amount) {
        /** @type {?} */
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            /** @type {?} */
            let value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            /** @type {?} */
            let pattern = /[\w\s]+/g;
            /** @type {?} */
            let stripped = value.replace(pattern, '');
            if (stripped.length < amount) {
                return { 'specialCharacterRule': { 'required': amount, 'actual': stripped.length } };
            }
            return undefined;
        };
        return validator;
    }
    ;
    /**
     * @param {?=} passwordControlName
     * @param {?=} confirmPasswordControlName
     * @return {?}
     */
    static mismatchedPasswords(passwordControlName, confirmPasswordControlName) {
        /** @type {?} */
        const validator = (group) => {
            /** @type {?} */
            let newPasswordValue = group.get(passwordControlName ? passwordControlName : 'newPassword').value;
            /** @type {?} */
            let newPasswordConfirmValue = group.get(confirmPasswordControlName ? confirmPasswordControlName : 'confirmPassword').value;
            if (newPasswordValue !== newPasswordConfirmValue) {
                AbstractControlUtil.addError(group.get(confirmPasswordControlName ? confirmPasswordControlName : 'confirmPassword'), 'mismatchedPasswords', true);
                return { 'mismatchedPasswords': true };
            }
            else {
                AbstractControlUtil.removeError(group.get(confirmPasswordControlName ? confirmPasswordControlName : 'confirmPassword'), 'mismatchedPasswords');
            }
            return undefined;
        };
        return validator;
    }
    ;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFzc3dvcmQtdmFsaWRhdG9ycy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC12YWxpZGF0b3JzLyIsInNvdXJjZXMiOlsiY29tcG9uZW50cy9wYXNzd29yZC9wYXNzd29yZC12YWxpZGF0b3JzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQzs7QUFHakUsTUFBTSxPQUFPLGtCQUFrQjs7Ozs7SUFFcEIsTUFBTSxDQUFDLHdCQUF3QixDQUFDLFdBQW1COztjQUNoRCxTQUFTLEdBQUcsQ0FBQyxPQUF3QixFQUEwQixFQUFFO1lBQ25FLElBQUksbUJBQW1CLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQztnQkFBRSxPQUFPLFNBQVMsQ0FBQzs7Z0JBQzVELFNBQVMsR0FBRyxXQUFXLEdBQUcsQ0FBQzs7Z0JBQzNCLE9BQU8sR0FBRyxzQkFBc0IsR0FBRyxTQUFTLEdBQUcsR0FBRztZQUN0RCxJQUFJLE9BQU8sQ0FBQyxLQUFLLEtBQUssRUFBRSxJQUFJLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQ2pFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxFQUFFLGFBQWEsRUFBRSxXQUFXLEVBQUUsRUFBRSxDQUFDO2FBQ3pFO1lBQ0QsT0FBTyxTQUFTLENBQUM7UUFDckIsQ0FBQztRQUNELE9BQU8sU0FBUyxDQUFDO0lBQ3JCLENBQUM7SUFBQSxDQUFDOzs7OztJQUVLLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxZQUFzQjs7Y0FDL0MsU0FBUyxHQUFHLENBQUMsT0FBd0IsRUFBMEIsRUFBRTtZQUNuRSxJQUFJLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUM7Z0JBQUUsT0FBTyxTQUFTLENBQUM7O2dCQUM1RCxLQUFLLEdBQVcsT0FBTyxDQUFDLEtBQUs7O2dCQUM3QixLQUFLLEdBQUcsSUFBSTs7Z0JB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QUFPLEVBQUUscUJBQXFCLEVBQUUsSUFBSSxFQUFFLENBQUM7YUFDMUM7aUJBQU07Z0JBQ0gsbUJBQW1CLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLHFCQUFxQixDQUFDLENBQUM7YUFDbEo7WUFDRCxPQUFPLFNBQVMsQ0FBQztRQUVyQixDQUFDO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDckIsQ0FBQztJQUFBLENBQUM7Q0FFTCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgVmFsaWRhdG9yRm4gfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2xVdGlsIH0gZnJvbSAnLi8uLi9hYnN0cmFjdC1jb250cm9sLXV0aWwnO1xuXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dmFyaWFibGUtbmFtZVxuZXhwb3J0IGNsYXNzIFBhc3N3b3JkVmFsaWRhdG9ycyB7XG5cbiAgICBwdWJsaWMgc3RhdGljIHJlcGVhdENoYXJhY3RlclJlZ2V4UnVsZShyZXBlYXRDb3VudDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHZhbGlkYXRvciA9IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0+IHtcbiAgICAgICAgICAgIGlmIChBYnN0cmFjdENvbnRyb2xVdGlsLmlzTm90UHJlc2VudChjb250cm9sKSkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGxldCByZXBlYXREZWMgPSByZXBlYXRDb3VudCAtIDE7XG4gICAgICAgICAgICBsZXQgcGF0dGVybiA9ICcoW15cXFxceDAwLVxcXFx4MUZdKVxcXFwxeycgKyByZXBlYXREZWMgKyAnfSc7XG4gICAgICAgICAgICBpZiAoY29udHJvbC52YWx1ZSAhPT0gJycgJiYgbmV3IFJlZ0V4cChwYXR0ZXJuKS50ZXN0KGNvbnRyb2wudmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgJ3JlcGVhdENoYXJhY3RlclJlZ2V4UnVsZSc6IHsgJ3JlcGVhdENvdW50JzogcmVwZWF0Q291bnQgfSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRvcjtcbiAgICB9O1xuXG4gICAgcHVibGljIHN0YXRpYyBhbGxvd2VkQ2hhcmFjdGVyUnVsZShhbGxvd2VkQ2hhcnM6IHN0cmluZ1tdKTogVmFsaWRhdG9yRm4ge1xuICAgICAgICBjb25zdCB2YWxpZGF0b3IgPSAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9PiB7XG4gICAgICAgICAgICBpZiAoQWJzdHJhY3RDb250cm9sVXRpbC5pc05vdFByZXNlbnQoY29udHJvbCkpIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICBsZXQgdmFsdWU6IHN0cmluZyA9IGNvbnRyb2wudmFsdWU7XG4gICAgICAgICAgICBsZXQgdmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgbGV0IGludmFsaWRDaGFyczogc3RyaW5nW10gPSBbXTtcblxuICAgICAgICAgICAgZm9yIChsZXQgY2hhciBvZiB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmIChhbGxvd2VkQ2hhcnMuaW5kZXhPZihjaGFyKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGludmFsaWRDaGFycy5pbmRleE9mKGNoYXIpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW52YWxpZENoYXJzLnB1c2goY2hhcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXZhbGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgJ2FsbG93ZWRDaGFyYWN0ZXJSdWxlJzogeyAnaW52YWxpZENoYXJzJzogaW52YWxpZENoYXJzLCAnYWxsb3dlZENoYXJzJzogYWxsb3dlZENoYXJzIH0gfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB2YWxpZGF0b3I7XG4gICAgfTtcblxuICAgIHB1YmxpYyBzdGF0aWMgYWxwaGFiZXRpY2FsQ2hhcmFjdGVyUnVsZShhbW91bnQ6IG51bWJlcik6IFZhbGlkYXRvckZuIHtcbiAgICAgICAgY29uc3QgdmFsaWRhdG9yID0gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPT4ge1xuICAgICAgICAgICAgaWYgKEFic3RyYWN0Q29udHJvbFV0aWwuaXNOb3RQcmVzZW50KGNvbnRyb2wpKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgbGV0IHZhbHVlOiBzdHJpbmcgPSBjb250cm9sLnZhbHVlO1xuICAgICAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcGF0dGVybiA9IC9bXkEtWmEtel0rL2c7XG4gICAgICAgICAgICBsZXQgc3RyaXBwZWQgPSB2YWx1ZS5yZXBsYWNlKHBhdHRlcm4sICcnKTtcbiAgICAgICAgICAgIGlmIChzdHJpcHBlZC5sZW5ndGggPCBhbW91bnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyAnYWxwaGFiZXRpY2FsQ2hhcmFjdGVyUnVsZSc6IHsgJ3JlcXVpcmVkJzogYW1vdW50LCAnYWN0dWFsJzogc3RyaXBwZWQubGVuZ3RoIH0gfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB2YWxpZGF0b3I7XG4gICAgfTtcblxuICAgIHB1YmxpYyBzdGF0aWMgZGlnaXRDaGFyYWN0ZXJSdWxlKGFtb3VudDogbnVtYmVyKTogVmFsaWRhdG9yRm4ge1xuICAgICAgICBjb25zdCB2YWxpZGF0b3IgPSAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9PiB7XG4gICAgICAgICAgICBpZiAoQWJzdHJhY3RDb250cm9sVXRpbC5pc05vdFByZXNlbnQoY29udHJvbCkpIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICBsZXQgdmFsdWU6IHN0cmluZyA9IGNvbnRyb2wudmFsdWU7XG4gICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBwYXR0ZXJuID0gL1teMC05XFwuXSsvZztcbiAgICAgICAgICAgIGxldCBzdHJpcHBlZCA9IHZhbHVlLnJlcGxhY2UocGF0dGVybiwgJycpO1xuICAgICAgICAgICAgaWYgKHN0cmlwcGVkLmxlbmd0aCA8IGFtb3VudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7ICdkaWdpdENoYXJhY3RlclJ1bGUnOiB7ICdyZXF1aXJlZCc6IGFtb3VudCwgJ2FjdHVhbCc6IHN0cmlwcGVkLmxlbmd0aCB9IH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdmFsaWRhdG9yO1xuICAgIH07XG5cbiAgICBwdWJsaWMgc3RhdGljIGxvd2VyY2FzZUNoYXJhY3RlclJ1bGUoYW1vdW50OiBudW1iZXIpOiBWYWxpZGF0b3JGbiB7XG4gICAgICAgIGNvbnN0IHZhbGlkYXRvciA9IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0+IHtcbiAgICAgICAgICAgIGlmIChBYnN0cmFjdENvbnRyb2xVdGlsLmlzTm90UHJlc2VudChjb250cm9sKSkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGxldCB2YWx1ZTogc3RyaW5nID0gY29udHJvbC52YWx1ZTtcbiAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHBhdHRlcm4gPSAvW15hLXpdKy9nO1xuICAgICAgICAgICAgbGV0IHN0cmlwcGVkID0gdmFsdWUucmVwbGFjZShwYXR0ZXJuLCAnJyk7XG4gICAgICAgICAgICBpZiAoc3RyaXBwZWQubGVuZ3RoIDwgYW1vdW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgJ2xvd2VyY2FzZUNoYXJhY3RlclJ1bGUnOiB7ICdyZXF1aXJlZCc6IGFtb3VudCwgJ2FjdHVhbCc6IHN0cmlwcGVkLmxlbmd0aCB9IH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdmFsaWRhdG9yO1xuICAgIH07XG5cbiAgICBwdWJsaWMgc3RhdGljIHVwcGVyY2FzZUNoYXJhY3RlclJ1bGUoYW1vdW50OiBudW1iZXIpOiBWYWxpZGF0b3JGbiB7XG4gICAgICAgIGNvbnN0IHZhbGlkYXRvciA9IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0+IHtcbiAgICAgICAgICAgIGlmIChBYnN0cmFjdENvbnRyb2xVdGlsLmlzTm90UHJlc2VudChjb250cm9sKSkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGxldCB2YWx1ZTogc3RyaW5nID0gY29udHJvbC52YWx1ZTtcbiAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHBhdHRlcm4gPSAvW15BLVpdKy9nO1xuICAgICAgICAgICAgbGV0IHN0cmlwcGVkID0gdmFsdWUucmVwbGFjZShwYXR0ZXJuLCAnJyk7XG4gICAgICAgICAgICBpZiAoc3RyaXBwZWQubGVuZ3RoIDwgYW1vdW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgJ3VwcGVyY2FzZUNoYXJhY3RlclJ1bGUnOiB7ICdyZXF1aXJlZCc6IGFtb3VudCwgJ2FjdHVhbCc6IHN0cmlwcGVkLmxlbmd0aCB9IH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdmFsaWRhdG9yO1xuICAgIH07XG5cbiAgICBwdWJsaWMgc3RhdGljIHNwZWNpYWxDaGFyYWN0ZXJSdWxlKGFtb3VudDogbnVtYmVyKTogVmFsaWRhdG9yRm4ge1xuICAgICAgICBjb25zdCB2YWxpZGF0b3IgPSAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9PiB7XG4gICAgICAgICAgICBpZiAoQWJzdHJhY3RDb250cm9sVXRpbC5pc05vdFByZXNlbnQoY29udHJvbCkpIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICBsZXQgdmFsdWU6IHN0cmluZyA9IGNvbnRyb2wudmFsdWU7XG4gICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBwYXR0ZXJuID0gL1tcXHdcXHNdKy9nO1xuICAgICAgICAgICAgbGV0IHN0cmlwcGVkID0gdmFsdWUucmVwbGFjZShwYXR0ZXJuLCAnJyk7XG4gICAgICAgICAgICBpZiAoc3RyaXBwZWQubGVuZ3RoIDwgYW1vdW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgJ3NwZWNpYWxDaGFyYWN0ZXJSdWxlJzogeyAncmVxdWlyZWQnOiBhbW91bnQsICdhY3R1YWwnOiBzdHJpcHBlZC5sZW5ndGggfSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRvcjtcbiAgICB9O1xuXG4gICAgcHVibGljIHN0YXRpYyBtaXNtYXRjaGVkUGFzc3dvcmRzKHBhc3N3b3JkQ29udHJvbE5hbWU/OiBzdHJpbmcsIGNvbmZpcm1QYXNzd29yZENvbnRyb2xOYW1lPzogc3RyaW5nKTogVmFsaWRhdG9yRm4ge1xuICAgICAgICBjb25zdCB2YWxpZGF0b3IgPSAoZ3JvdXA6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPT4ge1xuICAgICAgICAgICAgbGV0IG5ld1Bhc3N3b3JkVmFsdWUgPSBncm91cC5nZXQocGFzc3dvcmRDb250cm9sTmFtZSA/IHBhc3N3b3JkQ29udHJvbE5hbWUgOiAnbmV3UGFzc3dvcmQnKS52YWx1ZTtcbiAgICAgICAgICAgIGxldCBuZXdQYXNzd29yZENvbmZpcm1WYWx1ZSA9IGdyb3VwLmdldChjb25maXJtUGFzc3dvcmRDb250cm9sTmFtZSA/IGNvbmZpcm1QYXNzd29yZENvbnRyb2xOYW1lIDogJ2NvbmZpcm1QYXNzd29yZCcpLnZhbHVlO1xuICAgICAgICAgICAgaWYgKG5ld1Bhc3N3b3JkVmFsdWUgIT09IG5ld1Bhc3N3b3JkQ29uZmlybVZhbHVlKSB7XG4gICAgICAgICAgICAgICAgQWJzdHJhY3RDb250cm9sVXRpbC5hZGRFcnJvcihncm91cC5nZXQoY29uZmlybVBhc3N3b3JkQ29udHJvbE5hbWUgPyBjb25maXJtUGFzc3dvcmRDb250cm9sTmFtZSA6ICdjb25maXJtUGFzc3dvcmQnKSwgJ21pc21hdGNoZWRQYXNzd29yZHMnLCB0cnVlKVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgJ21pc21hdGNoZWRQYXNzd29yZHMnOiB0cnVlIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIEFic3RyYWN0Q29udHJvbFV0aWwucmVtb3ZlRXJyb3IoZ3JvdXAuZ2V0KGNvbmZpcm1QYXNzd29yZENvbnRyb2xOYW1lID8gY29uZmlybVBhc3N3b3JkQ29udHJvbE5hbWUgOiAnY29uZmlybVBhc3N3b3JkJyksICdtaXNtYXRjaGVkUGFzc3dvcmRzJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB2YWxpZGF0b3I7XG4gICAgfTtcblxufVxuIl19