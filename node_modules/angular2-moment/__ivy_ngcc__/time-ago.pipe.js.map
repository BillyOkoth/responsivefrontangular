{"version":3,"file":"time-ago.pipe.js","sources":["time-ago.pipe.ts"],"names":[],"mappings":"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","sourcesContent":["/* angular2-moment (c) 2015, 2016 Uri Shaked / MIT Licence */\r\n\r\nimport {Pipe, ChangeDetectorRef, PipeTransform, OnDestroy, NgZone} from '@angular/core';\r\nimport * as moment from 'moment';\r\n\r\n// under systemjs, moment is actually exported as the default export, so we account for that\r\nconst momentConstructor: (value?: any) => moment.Moment = (<any>moment).default || moment;\r\n\r\n@Pipe({name: 'amTimeAgo', pure: false})\r\nexport class TimeAgoPipe implements PipeTransform, OnDestroy {\r\n  private currentTimer: number;\r\n\r\n  private lastTime: Number;\r\n  private lastValue: Date | moment.Moment;\r\n  private lastOmitSuffix: boolean;\r\n  private lastLocale?: string;\r\n  private lastText: string;\r\n\r\n  constructor(private cdRef: ChangeDetectorRef, private ngZone: NgZone) {\r\n  }\r\n\r\n  transform(value: Date | moment.Moment, omitSuffix?: boolean): string {\r\n    if (this.hasChanged(value, omitSuffix)) {\r\n      this.lastTime = this.getTime(value);\r\n      this.lastValue = value;\r\n      this.lastOmitSuffix = omitSuffix;\r\n      this.lastLocale = this.getLocale(value);\r\n      this.removeTimer();\r\n      this.createTimer();\r\n      this.lastText = momentConstructor(value).from(momentConstructor(), omitSuffix);\r\n\r\n    } else {\r\n      this.createTimer();\r\n    }\r\n\r\n    return this.lastText;\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.removeTimer();\r\n  }\r\n\r\n\r\n  private createTimer() {\r\n    if (this.currentTimer) {\r\n      return;\r\n    }\r\n    const momentInstance = momentConstructor(this.lastValue);\r\n\r\n    const timeToUpdate = this.getSecondsUntilUpdate(momentInstance) * 1000;\r\n    this.currentTimer = this.ngZone.runOutsideAngular(() => {\r\n      if (typeof window !== 'undefined') {\r\n        return window.setTimeout(() => {\r\n          this.lastText = momentConstructor(this.lastValue).from(momentConstructor(), this.lastOmitSuffix);\r\n\r\n          this.currentTimer = null;\r\n          this.ngZone.run(() => this.cdRef.markForCheck());\r\n        }, timeToUpdate);\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  private removeTimer() {\r\n    if (this.currentTimer) {\r\n      window.clearTimeout(this.currentTimer);\r\n      this.currentTimer = null;\r\n    }\r\n  }\r\n\r\n  private getSecondsUntilUpdate(momentInstance: moment.Moment) {\r\n    const howOld = Math.abs(momentConstructor().diff(momentInstance, 'minute'));\r\n    if (howOld < 1) {\r\n      return 1;\r\n    } else if (howOld < 60) {\r\n      return 30;\r\n    } else if (howOld < 180) {\r\n      return 300;\r\n    } else {\r\n      return 3600;\r\n    }\r\n  }\r\n\r\n  private hasChanged(value: Date | moment.Moment, omitSuffix?: boolean) {\r\n    return this.getTime(value) !== this.lastTime\r\n      || this.getLocale(value) !== this.lastLocale\r\n      || omitSuffix !== this.lastOmitSuffix;\r\n  }\r\n\r\n  private getTime(value: Date | moment.Moment) {\r\n    if (moment.isDate(value)) {\r\n      return value.getTime();\r\n    } else if (moment.isMoment(value)) {\r\n      return value.valueOf();\r\n    } else {\r\n      return momentConstructor(value).valueOf();\r\n    }\r\n  }\r\n\r\n  private getLocale(value: Date | moment.Moment): string {\r\n    return moment.isMoment(value) ? value.locale() : null;\r\n  }\r\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}