/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { EventEmitter, Injectable, NgZone, Optional } from '@angular/core';
import { IdleExpiry } from './idleexpiry';
import { Interrupt } from './interrupt';
import { KeepaliveSvc } from './keepalivesvc';
import { LocalStorageExpiry } from './localstorageexpiry';
/** @enum {number} */
var AutoResume = {
    /*
     * Auto resume functionality will be disabled.
     */
    disabled: 0,
    /*
     * Can resume automatically even if they are idle.
     */
    idle: 1,
    /*
     * Can only resume automatically if they are not yet idle.
     */
    notIdle: 2,
};
export { AutoResume };
AutoResume[AutoResume.disabled] = 'disabled';
AutoResume[AutoResume.idle] = 'idle';
AutoResume[AutoResume.notIdle] = 'notIdle';
/**
 * A service for detecting and responding to user idleness.
 */
var Idle = /** @class */ (function () {
    function Idle(expiry, zone, keepaliveSvc) {
        this.expiry = expiry;
        this.zone = zone;
        this.idle = 20 * 60; // in seconds
        // in seconds
        this.timeoutVal = 30; // in seconds
        // in seconds
        this.autoResume = AutoResume.idle;
        this.interrupts = new Array();
        this.running = false;
        this.keepaliveEnabled = false;
        this.onIdleStart = new EventEmitter();
        this.onIdleEnd = new EventEmitter();
        this.onTimeoutWarning = new EventEmitter();
        this.onTimeout = new EventEmitter();
        this.onInterrupt = new EventEmitter();
        if (keepaliveSvc) {
            this.keepaliveSvc = keepaliveSvc;
            this.keepaliveEnabled = true;
        }
        this.setIdling(false);
    }
    /*
     * Sets the idle name for localStorage.
     * Important to set if multiple instances of Idle with LocalStorageExpiry
     * @param The name of the idle.
     */
    /*
       * Sets the idle name for localStorage.
       * Important to set if multiple instances of Idle with LocalStorageExpiry
       * @param The name of the idle.
       */
    /**
     * @param {?} key
     * @return {?}
     */
    Idle.prototype.setIdleName = /*
       * Sets the idle name for localStorage.
       * Important to set if multiple instances of Idle with LocalStorageExpiry
       * @param The name of the idle.
       */
    /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        if (this.expiry instanceof LocalStorageExpiry) {
            this.expiry.setIdleName(key);
        }
        else {
            throw new Error('Cannot set expiry key name because no LocalStorageExpiry has been provided.');
        }
    };
    /*
     * Returns whether or not keepalive integration is enabled.
     * @return True if integration is enabled; otherwise, false.
     */
    /*
       * Returns whether or not keepalive integration is enabled.
       * @return True if integration is enabled; otherwise, false.
       */
    /**
     * @return {?}
     */
    Idle.prototype.getKeepaliveEnabled = /*
       * Returns whether or not keepalive integration is enabled.
       * @return True if integration is enabled; otherwise, false.
       */
    /**
     * @return {?}
     */
    function () {
        return this.keepaliveEnabled;
    };
    /*
     * Sets and returns whether or not keepalive integration is enabled.
     * @param True if the integration is enabled; otherwise, false.
     * @return The current value.
     */
    /*
       * Sets and returns whether or not keepalive integration is enabled.
       * @param True if the integration is enabled; otherwise, false.
       * @return The current value.
       */
    /**
     * @param {?} value
     * @return {?}
     */
    Idle.prototype.setKeepaliveEnabled = /*
       * Sets and returns whether or not keepalive integration is enabled.
       * @param True if the integration is enabled; otherwise, false.
       * @return The current value.
       */
    /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (!this.keepaliveSvc) {
            throw new Error('Cannot enable keepalive integration because no KeepaliveSvc has been provided.');
        }
        return (this.keepaliveEnabled = value);
    };
    /*
     * Returns the current timeout value.
     * @return The timeout value in seconds.
     */
    /*
       * Returns the current timeout value.
       * @return The timeout value in seconds.
       */
    /**
     * @return {?}
     */
    Idle.prototype.getTimeout = /*
       * Returns the current timeout value.
       * @return The timeout value in seconds.
       */
    /**
     * @return {?}
     */
    function () {
        return this.timeoutVal;
    };
    /*
     * Sets the timeout value.
     * @param seconds - The timeout value in seconds. 0 or false to disable timeout feature.
     * @return The current value. If disabled, the value will be 0.
     */
    /*
       * Sets the timeout value.
       * @param seconds - The timeout value in seconds. 0 or false to disable timeout feature.
       * @return The current value. If disabled, the value will be 0.
       */
    /**
     * @param {?} seconds
     * @return {?}
     */
    Idle.prototype.setTimeout = /*
       * Sets the timeout value.
       * @param seconds - The timeout value in seconds. 0 or false to disable timeout feature.
       * @return The current value. If disabled, the value will be 0.
       */
    /**
     * @param {?} seconds
     * @return {?}
     */
    function (seconds) {
        if (seconds === false) {
            this.timeoutVal = 0;
        }
        else if (typeof seconds === 'number' && seconds >= 0) {
            this.timeoutVal = seconds;
        }
        else {
            throw new Error("'seconds' can only be 'false' or a positive number.");
        }
        return this.timeoutVal;
    };
    /*
     * Returns the current idle value.
     * @return The idle value in seconds.
     */
    /*
       * Returns the current idle value.
       * @return The idle value in seconds.
       */
    /**
     * @return {?}
     */
    Idle.prototype.getIdle = /*
       * Returns the current idle value.
       * @return The idle value in seconds.
       */
    /**
     * @return {?}
     */
    function () {
        return this.idle;
    };
    /*
     * Sets the idle value.
     * @param seconds - The idle value in seconds.
     * @return The idle value in seconds.
     */
    /*
       * Sets the idle value.
       * @param seconds - The idle value in seconds.
       * @return The idle value in seconds.
       */
    /**
     * @param {?} seconds
     * @return {?}
     */
    Idle.prototype.setIdle = /*
       * Sets the idle value.
       * @param seconds - The idle value in seconds.
       * @return The idle value in seconds.
       */
    /**
     * @param {?} seconds
     * @return {?}
     */
    function (seconds) {
        if (seconds <= 0) {
            throw new Error("'seconds' must be greater zero");
        }
        return (this.idle = seconds);
    };
    /*
     * Returns the current autoresume value.
     * @return The current value.
     */
    /*
       * Returns the current autoresume value.
       * @return The current value.
       */
    /**
     * @return {?}
     */
    Idle.prototype.getAutoResume = /*
       * Returns the current autoresume value.
       * @return The current value.
       */
    /**
     * @return {?}
     */
    function () {
        return this.autoResume;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    Idle.prototype.setAutoResume = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        return (this.autoResume = value);
    };
    /*
     * Sets interrupts from the specified sources.
     * @param sources - Interrupt sources.
     * @return The resulting interrupts.
     */
    /*
       * Sets interrupts from the specified sources.
       * @param sources - Interrupt sources.
       * @return The resulting interrupts.
       */
    /**
     * @param {?} sources
     * @return {?}
     */
    Idle.prototype.setInterrupts = /*
       * Sets interrupts from the specified sources.
       * @param sources - Interrupt sources.
       * @return The resulting interrupts.
       */
    /**
     * @param {?} sources
     * @return {?}
     */
    function (sources) {
        var e_1, _a;
        this.clearInterrupts();
        /** @type {?} */
        var self = this;
        try {
            for (var sources_1 = tslib_1.__values(sources), sources_1_1 = sources_1.next(); !sources_1_1.done; sources_1_1 = sources_1.next()) {
                var source = sources_1_1.value;
                /** @type {?} */
                var sub = new Interrupt(source);
                sub.subscribe((/**
                 * @param {?} args
                 * @return {?}
                 */
                function (args) {
                    self.interrupt(args.force, args.innerArgs);
                }));
                this.interrupts.push(sub);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (sources_1_1 && !sources_1_1.done && (_a = sources_1.return)) _a.call(sources_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return this.interrupts;
    };
    /*
     * Returns the current interrupts.
     * @return The current interrupts.
     */
    /*
       * Returns the current interrupts.
       * @return The current interrupts.
       */
    /**
     * @return {?}
     */
    Idle.prototype.getInterrupts = /*
       * Returns the current interrupts.
       * @return The current interrupts.
       */
    /**
     * @return {?}
     */
    function () {
        return this.interrupts;
    };
    /*
     * Pauses, unsubscribes, and clears the current interrupt subscriptions.
     */
    /*
       * Pauses, unsubscribes, and clears the current interrupt subscriptions.
       */
    /**
     * @return {?}
     */
    Idle.prototype.clearInterrupts = /*
       * Pauses, unsubscribes, and clears the current interrupt subscriptions.
       */
    /**
     * @return {?}
     */
    function () {
        var e_2, _a;
        try {
            for (var _b = tslib_1.__values(this.interrupts), _c = _b.next(); !_c.done; _c = _b.next()) {
                var sub = _c.value;
                sub.pause();
                sub.unsubscribe();
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_2) throw e_2.error; }
        }
        this.interrupts.length = 0;
    };
    /*
     * Returns whether or not the service is running i.e. watching for idleness.
     * @return True if service is watching; otherwise, false.
     */
    /*
       * Returns whether or not the service is running i.e. watching for idleness.
       * @return True if service is watching; otherwise, false.
       */
    /**
     * @return {?}
     */
    Idle.prototype.isRunning = /*
       * Returns whether or not the service is running i.e. watching for idleness.
       * @return True if service is watching; otherwise, false.
       */
    /**
     * @return {?}
     */
    function () {
        return this.running;
    };
    /*
     * Returns whether or not the user is considered idle.
     * @return True if the user is in the idle state; otherwise, false.
     */
    /*
       * Returns whether or not the user is considered idle.
       * @return True if the user is in the idle state; otherwise, false.
       */
    /**
     * @return {?}
     */
    Idle.prototype.isIdling = /*
       * Returns whether or not the user is considered idle.
       * @return True if the user is in the idle state; otherwise, false.
       */
    /**
     * @return {?}
     */
    function () {
        return this.idling;
    };
    /*
     * Starts watching for inactivity.
     */
    /*
       * Starts watching for inactivity.
       */
    /**
     * @param {?=} skipExpiry
     * @return {?}
     */
    Idle.prototype.watch = /*
       * Starts watching for inactivity.
       */
    /**
     * @param {?=} skipExpiry
     * @return {?}
     */
    function (skipExpiry) {
        var _this = this;
        this.safeClearInterval('idleHandle');
        this.safeClearInterval('timeoutHandle');
        /** @type {?} */
        var timeout = !this.timeoutVal ? 0 : this.timeoutVal;
        if (!skipExpiry) {
            /** @type {?} */
            var value = new Date(this.expiry.now().getTime() + (this.idle + timeout) * 1000);
            this.expiry.last(value);
        }
        if (this.idling) {
            this.toggleState();
        }
        if (!this.running) {
            this.startKeepalive();
            this.toggleInterrupts(true);
        }
        this.running = true;
        /** @type {?} */
        var watchFn = (/**
         * @return {?}
         */
        function () {
            _this.zone.run((/**
             * @return {?}
             */
            function () {
                /** @type {?} */
                var diff = _this.getExpiryDiff(timeout);
                if (diff > 0) {
                    _this.safeClearInterval('idleHandle');
                    _this.setIdleIntervalOutsideOfZone(watchFn, diff);
                }
                else {
                    _this.toggleState();
                }
            }));
        });
        this.setIdleIntervalOutsideOfZone(watchFn, this.idle * 1000);
    };
    /*
     * Allows protractor tests to call waitForAngular without hanging
     */
    /*
       * Allows protractor tests to call waitForAngular without hanging
       */
    /**
     * @param {?} watchFn
     * @param {?} frequency
     * @return {?}
     */
    Idle.prototype.setIdleIntervalOutsideOfZone = /*
       * Allows protractor tests to call waitForAngular without hanging
       */
    /**
     * @param {?} watchFn
     * @param {?} frequency
     * @return {?}
     */
    function (watchFn, frequency) {
        var _this = this;
        this.zone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.idleHandle = setInterval(watchFn, frequency);
        }));
    };
    /*
     * Stops watching for inactivity.
     */
    /*
       * Stops watching for inactivity.
       */
    /**
     * @return {?}
     */
    Idle.prototype.stop = /*
       * Stops watching for inactivity.
       */
    /**
     * @return {?}
     */
    function () {
        this.stopKeepalive();
        this.toggleInterrupts(false);
        this.safeClearInterval('idleHandle');
        this.safeClearInterval('timeoutHandle');
        this.setIdling(false);
        this.running = false;
        this.expiry.last(null);
    };
    /*
     * Forces a timeout event and state.
     */
    /*
       * Forces a timeout event and state.
       */
    /**
     * @return {?}
     */
    Idle.prototype.timeout = /*
       * Forces a timeout event and state.
       */
    /**
     * @return {?}
     */
    function () {
        this.stopKeepalive();
        this.toggleInterrupts(false);
        this.safeClearInterval('idleHandle');
        this.safeClearInterval('timeoutHandle');
        this.setIdling(true);
        this.running = false;
        this.countdown = 0;
        this.onTimeout.emit(null);
    };
    /*
     * Signals that user activity has occurred.
     * @param force - Forces watch to be called, unless they are timed out.
     * @param eventArgs - Optional source event arguments.
     */
    /*
       * Signals that user activity has occurred.
       * @param force - Forces watch to be called, unless they are timed out.
       * @param eventArgs - Optional source event arguments.
       */
    /**
     * @param {?=} force
     * @param {?=} eventArgs
     * @return {?}
     */
    Idle.prototype.interrupt = /*
       * Signals that user activity has occurred.
       * @param force - Forces watch to be called, unless they are timed out.
       * @param eventArgs - Optional source event arguments.
       */
    /**
     * @param {?=} force
     * @param {?=} eventArgs
     * @return {?}
     */
    function (force, eventArgs) {
        if (!this.running) {
            return;
        }
        if (this.timeoutVal && this.expiry.isExpired()) {
            this.timeout();
            return;
        }
        this.onInterrupt.emit(eventArgs);
        if (force === true ||
            this.autoResume === AutoResume.idle ||
            (this.autoResume === AutoResume.notIdle && !this.expiry.idling())) {
            this.watch(force);
        }
    };
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    Idle.prototype.setIdling = /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.idling = value;
        this.expiry.idling(value);
    };
    /**
     * @private
     * @return {?}
     */
    Idle.prototype.toggleState = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.setIdling(!this.idling);
        if (this.idling) {
            this.onIdleStart.emit(null);
            this.stopKeepalive();
            if (this.timeoutVal > 0) {
                this.countdown = this.timeoutVal;
                this.doCountdown();
                this.setTimoutIntervalOutsideZone((/**
                 * @return {?}
                 */
                function () {
                    _this.doCountdownInZone();
                }), 1000);
            }
        }
        else {
            this.toggleInterrupts(true);
            this.onIdleEnd.emit(null);
            this.startKeepalive();
        }
        this.safeClearInterval('idleHandle');
    };
    /**
     * @private
     * @param {?} intervalFn
     * @param {?} frequency
     * @return {?}
     */
    Idle.prototype.setTimoutIntervalOutsideZone = /**
     * @private
     * @param {?} intervalFn
     * @param {?} frequency
     * @return {?}
     */
    function (intervalFn, frequency) {
        var _this = this;
        this.zone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.timeoutHandle = setInterval((/**
             * @return {?}
             */
            function () {
                intervalFn();
            }), frequency);
        }));
    };
    /**
     * @private
     * @param {?} resume
     * @return {?}
     */
    Idle.prototype.toggleInterrupts = /**
     * @private
     * @param {?} resume
     * @return {?}
     */
    function (resume) {
        var e_3, _a;
        try {
            for (var _b = tslib_1.__values(this.interrupts), _c = _b.next(); !_c.done; _c = _b.next()) {
                var interrupt = _c.value;
                if (resume) {
                    interrupt.resume();
                }
                else {
                    interrupt.pause();
                }
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_3) throw e_3.error; }
        }
    };
    /**
     * @private
     * @param {?} timeout
     * @return {?}
     */
    Idle.prototype.getExpiryDiff = /**
     * @private
     * @param {?} timeout
     * @return {?}
     */
    function (timeout) {
        /** @type {?} */
        var now = this.expiry.now();
        /** @type {?} */
        var last = this.expiry.last() || now;
        return last.getTime() - now.getTime() - timeout * 1000;
    };
    /**
     * @private
     * @return {?}
     */
    Idle.prototype.doCountdownInZone = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.zone.run((/**
         * @return {?}
         */
        function () {
            _this.doCountdown();
        }));
    };
    /**
     * @private
     * @return {?}
     */
    Idle.prototype.doCountdown = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var diff = this.getExpiryDiff(this.timeoutVal);
        if (diff > 0) {
            this.safeClearInterval('timeoutHandle');
            this.interrupt(true);
            return;
        }
        if (!this.idling) {
            return;
        }
        if (this.countdown <= 0) {
            this.timeout();
            return;
        }
        this.onTimeoutWarning.emit(this.countdown);
        this.countdown--;
    };
    /**
     * @private
     * @param {?} handleName
     * @return {?}
     */
    Idle.prototype.safeClearInterval = /**
     * @private
     * @param {?} handleName
     * @return {?}
     */
    function (handleName) {
        /** @type {?} */
        var handle = this[handleName];
        if (handle !== null && typeof handle !== 'undefined') {
            clearInterval(this[handleName]);
            this[handleName] = null;
        }
    };
    /**
     * @private
     * @return {?}
     */
    Idle.prototype.startKeepalive = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.keepaliveSvc || !this.keepaliveEnabled) {
            return;
        }
        if (this.running) {
            this.keepaliveSvc.ping();
        }
        this.keepaliveSvc.start();
    };
    /**
     * @private
     * @return {?}
     */
    Idle.prototype.stopKeepalive = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.keepaliveSvc || !this.keepaliveEnabled) {
            return;
        }
        this.keepaliveSvc.stop();
    };
    /*
     * Called by Angular when destroying the instance.
     */
    /*
       * Called by Angular when destroying the instance.
       */
    /**
     * @return {?}
     */
    Idle.prototype.ngOnDestroy = /*
       * Called by Angular when destroying the instance.
       */
    /**
     * @return {?}
     */
    function () {
        this.stop();
        this.clearInterrupts();
    };
    Idle.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    Idle.ctorParameters = function () { return [
        { type: IdleExpiry },
        { type: NgZone },
        { type: KeepaliveSvc, decorators: [{ type: Optional }] }
    ]; };
    return Idle;
}());
export { Idle };
if (false) {
    /**
     * @type {?}
     * @private
     */
    Idle.prototype.idle;
    /**
     * @type {?}
     * @private
     */
    Idle.prototype.timeoutVal;
    /**
     * @type {?}
     * @private
     */
    Idle.prototype.autoResume;
    /**
     * @type {?}
     * @private
     */
    Idle.prototype.interrupts;
    /**
     * @type {?}
     * @private
     */
    Idle.prototype.running;
    /**
     * @type {?}
     * @private
     */
    Idle.prototype.idling;
    /**
     * @type {?}
     * @private
     */
    Idle.prototype.idleHandle;
    /**
     * @type {?}
     * @private
     */
    Idle.prototype.timeoutHandle;
    /**
     * @type {?}
     * @private
     */
    Idle.prototype.countdown;
    /**
     * @type {?}
     * @private
     */
    Idle.prototype.keepaliveEnabled;
    /**
     * @type {?}
     * @private
     */
    Idle.prototype.keepaliveSvc;
    /** @type {?} */
    Idle.prototype.onIdleStart;
    /** @type {?} */
    Idle.prototype.onIdleEnd;
    /** @type {?} */
    Idle.prototype.onTimeoutWarning;
    /** @type {?} */
    Idle.prototype.onTimeout;
    /** @type {?} */
    Idle.prototype.onInterrupt;
    /**
     * @type {?}
     * @private
     */
    Idle.prototype.expiry;
    /**
     * @type {?}
     * @private
     */
    Idle.prototype.zone;
    /* Skipping unhandled member: [key: string]: any;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWRsZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BuZy1pZGxlL2NvcmUvIiwic291cmNlcyI6WyJsaWIvaWRsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFDTCxZQUFZLEVBQ1osVUFBVSxFQUNWLE1BQU0sRUFFTixRQUFRLEVBQ1QsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMxQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBR3hDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5QyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQzs7O0lBTXhEOztPQUVHO0lBQ0gsV0FBUTtJQUNSOztPQUVHO0lBQ0gsT0FBSTtJQUNKOztPQUVHO0lBQ0gsVUFBTzs7Ozs7Ozs7O0FBTVQ7SUFzQkUsY0FDVSxNQUFrQixFQUNsQixJQUFZLEVBQ1IsWUFBMkI7UUFGL0IsV0FBTSxHQUFOLE1BQU0sQ0FBWTtRQUNsQixTQUFJLEdBQUosSUFBSSxDQUFRO1FBdEJkLFNBQUksR0FBVyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsYUFBYTs7UUFDckMsZUFBVSxHQUFHLEVBQUUsQ0FBQyxDQUFDLGFBQWE7O1FBQzlCLGVBQVUsR0FBZSxVQUFVLENBQUMsSUFBSSxDQUFDO1FBQ3pDLGVBQVUsR0FBcUIsSUFBSSxLQUFLLEVBQUUsQ0FBQztRQUMzQyxZQUFPLEdBQUcsS0FBSyxDQUFDO1FBS2hCLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUcxQixnQkFBVyxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3BELGNBQVMsR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsRCxxQkFBZ0IsR0FBeUIsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUNwRSxjQUFTLEdBQXlCLElBQUksWUFBWSxFQUFVLENBQUM7UUFDN0QsZ0JB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O0lBQ3pELGdDQUEyRTs7SUFDM0UseUJBQW9FOztJQUNwRSwyQkFBMkQ7Ozs7O0lBS3pELHNCQUEwQjs7Ozs7SUFDMUIsb0JBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRXZlbnRFbWl0dGVyLFxuICBJbmplY3RhYmxlLFxuICBOZ1pvbmUsXG4gIE9uRGVzdHJveSxcbiAgT3B0aW9uYWxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IElkbGVFeHBpcnkgfSBmcm9tICcuL2lkbGVleHBpcnknO1xuaW1wb3J0IHsgSW50ZXJydXB0IH0gZnJvbSAnLi9pbnRlcnJ1cHQnO1xuaW1wb3J0IHsgSW50ZXJydXB0QXJncyB9IGZyb20gJy4vaW50ZXJydXB0YXJncyc7XG5pbXBvcnQgeyBJbnRlcnJ1cHRTb3VyY2UgfSBmcm9tICcuL2ludGVycnVwdHNvdXJjZSc7XG5pbXBvcnQgeyBLZWVwYWxpdmVTdmMgfSBmcm9tICcuL2tlZXBhbGl2ZXN2Yyc7XG5pbXBvcnQgeyBMb2NhbFN0b3JhZ2VFeHBpcnkgfSBmcm9tICcuL2xvY2Fsc3RvcmFnZWV4cGlyeSc7XG5cbi8qXG4gKiBJbmRpY2F0ZXMgdGhlIGRlc2lyZWQgYXV0byByZXN1bWUgYmVoYXZpb3IuXG4gKi9cbmV4cG9ydCBlbnVtIEF1dG9SZXN1bWUge1xuICAvKlxuICAgKiBBdXRvIHJlc3VtZSBmdW5jdGlvbmFsaXR5IHdpbGwgYmUgZGlzYWJsZWQuXG4gICAqL1xuICBkaXNhYmxlZCxcbiAgLypcbiAgICogQ2FuIHJlc3VtZSBhdXRvbWF0aWNhbGx5IGV2ZW4gaWYgdGhleSBhcmUgaWRsZS5cbiAgICovXG4gIGlkbGUsXG4gIC8qXG4gICAqIENhbiBvbmx5IHJlc3VtZSBhdXRvbWF0aWNhbGx5IGlmIHRoZXkgYXJlIG5vdCB5ZXQgaWRsZS5cbiAgICovXG4gIG5vdElkbGVcbn1cblxuLyoqXG4gKiBBIHNlcnZpY2UgZm9yIGRldGVjdGluZyBhbmQgcmVzcG9uZGluZyB0byB1c2VyIGlkbGVuZXNzLlxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgSWRsZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIHByaXZhdGUgaWRsZTogbnVtYmVyID0gMjAgKiA2MDsgLy8gaW4gc2Vjb25kc1xuICBwcml2YXRlIHRpbWVvdXRWYWwgPSAzMDsgLy8gaW4gc2Vjb25kc1xuICBwcml2YXRlIGF1dG9SZXN1bWU6IEF1dG9SZXN1bWUgPSBBdXRvUmVzdW1lLmlkbGU7XG4gIHByaXZhdGUgaW50ZXJydXB0czogQXJyYXk8SW50ZXJydXB0PiA9IG5ldyBBcnJheSgpO1xuICBwcml2YXRlIHJ1bm5pbmcgPSBmYWxzZTtcbiAgcHJpdmF0ZSBpZGxpbmc6IGJvb2xlYW47XG4gIHByaXZhdGUgaWRsZUhhbmRsZTogYW55O1xuICBwcml2YXRlIHRpbWVvdXRIYW5kbGU6IGFueTtcbiAgcHJpdmF0ZSBjb3VudGRvd246IG51bWJlcjtcbiAgcHJpdmF0ZSBrZWVwYWxpdmVFbmFibGVkID0gZmFsc2U7XG4gIHByaXZhdGUga2VlcGFsaXZlU3ZjOiBLZWVwYWxpdmVTdmM7XG5cbiAgcHVibGljIG9uSWRsZVN0YXJ0OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgcHVibGljIG9uSWRsZUVuZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIHB1YmxpYyBvblRpbWVvdXRXYXJuaW5nOiBFdmVudEVtaXR0ZXI8bnVtYmVyPiA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xuICBwdWJsaWMgb25UaW1lb3V0OiBFdmVudEVtaXR0ZXI8bnVtYmVyPiA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xuICBwdWJsaWMgb25JbnRlcnJ1cHQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIFtrZXk6IHN0cmluZ106IGFueTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGV4cGlyeTogSWRsZUV4cGlyeSxcbiAgICBwcml2YXRlIHpvbmU6IE5nWm9uZSxcbiAgICBAT3B0aW9uYWwoKSBrZWVwYWxpdmVTdmM/OiBLZWVwYWxpdmVTdmNcbiAgKSB7XG4gICAgaWYgKGtlZXBhbGl2ZVN2Yykge1xuICAgICAgdGhpcy5rZWVwYWxpdmVTdmMgPSBrZWVwYWxpdmVTdmM7XG4gICAgICB0aGlzLmtlZXBhbGl2ZUVuYWJsZWQgPSB0cnVlO1xuICAgIH1cbiAgICB0aGlzLnNldElkbGluZyhmYWxzZSk7XG4gIH1cblxuICAvKlxuICAgKiBTZXRzIHRoZSBpZGxlIG5hbWUgZm9yIGxvY2FsU3RvcmFnZS5cbiAgICogSW1wb3J0YW50IHRvIHNldCBpZiBtdWx0aXBsZSBpbnN0YW5jZXMgb2YgSWRsZSB3aXRoIExvY2FsU3RvcmFnZUV4cGlyeVxuICAgKiBAcGFyYW0gVGhlIG5hbWUgb2YgdGhlIGlkbGUuXG4gICAqL1xuICBzZXRJZGxlTmFtZShrZXk6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICh0aGlzLmV4cGlyeSBpbnN0YW5jZW9mIExvY2FsU3RvcmFnZUV4cGlyeSkge1xuICAgICAgdGhpcy5leHBpcnkuc2V0SWRsZU5hbWUoa2V5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnQ2Fubm90IHNldCBleHBpcnkga2V5IG5hbWUgYmVjYXVzZSBubyBMb2NhbFN0b3JhZ2VFeHBpcnkgaGFzIGJlZW4gcHJvdmlkZWQuJ1xuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IGtlZXBhbGl2ZSBpbnRlZ3JhdGlvbiBpcyBlbmFibGVkLlxuICAgKiBAcmV0dXJuIFRydWUgaWYgaW50ZWdyYXRpb24gaXMgZW5hYmxlZDsgb3RoZXJ3aXNlLCBmYWxzZS5cbiAgICovXG4gIGdldEtlZXBhbGl2ZUVuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMua2VlcGFsaXZlRW5hYmxlZDtcbiAgfVxuXG4gIC8qXG4gICAqIFNldHMgYW5kIHJldHVybnMgd2hldGhlciBvciBub3Qga2VlcGFsaXZlIGludGVncmF0aW9uIGlzIGVuYWJsZWQuXG4gICAqIEBwYXJhbSBUcnVlIGlmIHRoZSBpbnRlZ3JhdGlvbiBpcyBlbmFibGVkOyBvdGhlcndpc2UsIGZhbHNlLlxuICAgKiBAcmV0dXJuIFRoZSBjdXJyZW50IHZhbHVlLlxuICAgKi9cbiAgc2V0S2VlcGFsaXZlRW5hYmxlZCh2YWx1ZTogYm9vbGVhbik6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5rZWVwYWxpdmVTdmMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ0Nhbm5vdCBlbmFibGUga2VlcGFsaXZlIGludGVncmF0aW9uIGJlY2F1c2Ugbm8gS2VlcGFsaXZlU3ZjIGhhcyBiZWVuIHByb3ZpZGVkLidcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuICh0aGlzLmtlZXBhbGl2ZUVuYWJsZWQgPSB2YWx1ZSk7XG4gIH1cblxuICAvKlxuICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IHRpbWVvdXQgdmFsdWUuXG4gICAqIEByZXR1cm4gVGhlIHRpbWVvdXQgdmFsdWUgaW4gc2Vjb25kcy5cbiAgICovXG4gIGdldFRpbWVvdXQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy50aW1lb3V0VmFsO1xuICB9XG5cbiAgLypcbiAgICogU2V0cyB0aGUgdGltZW91dCB2YWx1ZS5cbiAgICogQHBhcmFtIHNlY29uZHMgLSBUaGUgdGltZW91dCB2YWx1ZSBpbiBzZWNvbmRzLiAwIG9yIGZhbHNlIHRvIGRpc2FibGUgdGltZW91dCBmZWF0dXJlLlxuICAgKiBAcmV0dXJuIFRoZSBjdXJyZW50IHZhbHVlLiBJZiBkaXNhYmxlZCwgdGhlIHZhbHVlIHdpbGwgYmUgMC5cbiAgICovXG4gIHNldFRpbWVvdXQoc2Vjb25kczogbnVtYmVyIHwgYm9vbGVhbik6IG51bWJlciB7XG4gICAgaWYgKHNlY29uZHMgPT09IGZhbHNlKSB7XG4gICAgICB0aGlzLnRpbWVvdXRWYWwgPSAwO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHNlY29uZHMgPT09ICdudW1iZXInICYmIHNlY29uZHMgPj0gMCkge1xuICAgICAgdGhpcy50aW1lb3V0VmFsID0gc2Vjb25kcztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiJ3NlY29uZHMnIGNhbiBvbmx5IGJlICdmYWxzZScgb3IgYSBwb3NpdGl2ZSBudW1iZXIuXCIpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnRpbWVvdXRWYWw7XG4gIH1cblxuICAvKlxuICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGlkbGUgdmFsdWUuXG4gICAqIEByZXR1cm4gVGhlIGlkbGUgdmFsdWUgaW4gc2Vjb25kcy5cbiAgICovXG4gIGdldElkbGUoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5pZGxlO1xuICB9XG5cbiAgLypcbiAgICogU2V0cyB0aGUgaWRsZSB2YWx1ZS5cbiAgICogQHBhcmFtIHNlY29uZHMgLSBUaGUgaWRsZSB2YWx1ZSBpbiBzZWNvbmRzLlxuICAgKiBAcmV0dXJuIFRoZSBpZGxlIHZhbHVlIGluIHNlY29uZHMuXG4gICAqL1xuICBzZXRJZGxlKHNlY29uZHM6IG51bWJlcik6IG51bWJlciB7XG4gICAgaWYgKHNlY29uZHMgPD0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiJ3NlY29uZHMnIG11c3QgYmUgZ3JlYXRlciB6ZXJvXCIpO1xuICAgIH1cblxuICAgIHJldHVybiAodGhpcy5pZGxlID0gc2Vjb25kcyk7XG4gIH1cblxuICAvKlxuICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGF1dG9yZXN1bWUgdmFsdWUuXG4gICAqIEByZXR1cm4gVGhlIGN1cnJlbnQgdmFsdWUuXG4gICAqL1xuICBnZXRBdXRvUmVzdW1lKCk6IEF1dG9SZXN1bWUge1xuICAgIHJldHVybiB0aGlzLmF1dG9SZXN1bWU7XG4gIH1cblxuICBzZXRBdXRvUmVzdW1lKHZhbHVlOiBBdXRvUmVzdW1lKTogQXV0b1Jlc3VtZSB7XG4gICAgcmV0dXJuICh0aGlzLmF1dG9SZXN1bWUgPSB2YWx1ZSk7XG4gIH1cblxuICAvKlxuICAgKiBTZXRzIGludGVycnVwdHMgZnJvbSB0aGUgc3BlY2lmaWVkIHNvdXJjZXMuXG4gICAqIEBwYXJhbSBzb3VyY2VzIC0gSW50ZXJydXB0IHNvdXJjZXMuXG4gICAqIEByZXR1cm4gVGhlIHJlc3VsdGluZyBpbnRlcnJ1cHRzLlxuICAgKi9cbiAgc2V0SW50ZXJydXB0cyhzb3VyY2VzOiBBcnJheTxJbnRlcnJ1cHRTb3VyY2U+KTogQXJyYXk8SW50ZXJydXB0PiB7XG4gICAgdGhpcy5jbGVhckludGVycnVwdHMoKTtcblxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgZm9yIChjb25zdCBzb3VyY2Ugb2Ygc291cmNlcykge1xuICAgICAgY29uc3Qgc3ViID0gbmV3IEludGVycnVwdChzb3VyY2UpO1xuICAgICAgc3ViLnN1YnNjcmliZSgoYXJnczogSW50ZXJydXB0QXJncykgPT4ge1xuICAgICAgICBzZWxmLmludGVycnVwdChhcmdzLmZvcmNlLCBhcmdzLmlubmVyQXJncyk7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5pbnRlcnJ1cHRzLnB1c2goc3ViKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5pbnRlcnJ1cHRzO1xuICB9XG5cbiAgLypcbiAgICogUmV0dXJucyB0aGUgY3VycmVudCBpbnRlcnJ1cHRzLlxuICAgKiBAcmV0dXJuIFRoZSBjdXJyZW50IGludGVycnVwdHMuXG4gICAqL1xuICBnZXRJbnRlcnJ1cHRzKCk6IEFycmF5PEludGVycnVwdD4ge1xuICAgIHJldHVybiB0aGlzLmludGVycnVwdHM7XG4gIH1cblxuICAvKlxuICAgKiBQYXVzZXMsIHVuc3Vic2NyaWJlcywgYW5kIGNsZWFycyB0aGUgY3VycmVudCBpbnRlcnJ1cHQgc3Vic2NyaXB0aW9ucy5cbiAgICovXG4gIGNsZWFySW50ZXJydXB0cygpOiB2b2lkIHtcbiAgICBmb3IgKGNvbnN0IHN1YiBvZiB0aGlzLmludGVycnVwdHMpIHtcbiAgICAgIHN1Yi5wYXVzZSgpO1xuICAgICAgc3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuXG4gICAgdGhpcy5pbnRlcnJ1cHRzLmxlbmd0aCA9IDA7XG4gIH1cblxuICAvKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBzZXJ2aWNlIGlzIHJ1bm5pbmcgaS5lLiB3YXRjaGluZyBmb3IgaWRsZW5lc3MuXG4gICAqIEByZXR1cm4gVHJ1ZSBpZiBzZXJ2aWNlIGlzIHdhdGNoaW5nOyBvdGhlcndpc2UsIGZhbHNlLlxuICAgKi9cbiAgaXNSdW5uaW5nKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnJ1bm5pbmc7XG4gIH1cblxuICAvKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSB1c2VyIGlzIGNvbnNpZGVyZWQgaWRsZS5cbiAgICogQHJldHVybiBUcnVlIGlmIHRoZSB1c2VyIGlzIGluIHRoZSBpZGxlIHN0YXRlOyBvdGhlcndpc2UsIGZhbHNlLlxuICAgKi9cbiAgaXNJZGxpbmcoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaWRsaW5nO1xuICB9XG5cbiAgLypcbiAgICogU3RhcnRzIHdhdGNoaW5nIGZvciBpbmFjdGl2aXR5LlxuICAgKi9cbiAgd2F0Y2goc2tpcEV4cGlyeT86IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLnNhZmVDbGVhckludGVydmFsKCdpZGxlSGFuZGxlJyk7XG4gICAgdGhpcy5zYWZlQ2xlYXJJbnRlcnZhbCgndGltZW91dEhhbmRsZScpO1xuXG4gICAgY29uc3QgdGltZW91dCA9ICF0aGlzLnRpbWVvdXRWYWwgPyAwIDogdGhpcy50aW1lb3V0VmFsO1xuICAgIGlmICghc2tpcEV4cGlyeSkge1xuICAgICAgY29uc3QgdmFsdWUgPSBuZXcgRGF0ZShcbiAgICAgICAgdGhpcy5leHBpcnkubm93KCkuZ2V0VGltZSgpICsgKHRoaXMuaWRsZSArIHRpbWVvdXQpICogMTAwMFxuICAgICAgKTtcbiAgICAgIHRoaXMuZXhwaXJ5Lmxhc3QodmFsdWUpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlkbGluZykge1xuICAgICAgdGhpcy50b2dnbGVTdGF0ZSgpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMucnVubmluZykge1xuICAgICAgdGhpcy5zdGFydEtlZXBhbGl2ZSgpO1xuICAgICAgdGhpcy50b2dnbGVJbnRlcnJ1cHRzKHRydWUpO1xuICAgIH1cblxuICAgIHRoaXMucnVubmluZyA9IHRydWU7XG5cbiAgICBjb25zdCB3YXRjaEZuID0gKCkgPT4ge1xuICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgIGNvbnN0IGRpZmYgPSB0aGlzLmdldEV4cGlyeURpZmYodGltZW91dCk7XG4gICAgICAgIGlmIChkaWZmID4gMCkge1xuICAgICAgICAgIHRoaXMuc2FmZUNsZWFySW50ZXJ2YWwoJ2lkbGVIYW5kbGUnKTtcbiAgICAgICAgICB0aGlzLnNldElkbGVJbnRlcnZhbE91dHNpZGVPZlpvbmUod2F0Y2hGbiwgZGlmZik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy50b2dnbGVTdGF0ZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5zZXRJZGxlSW50ZXJ2YWxPdXRzaWRlT2Zab25lKHdhdGNoRm4sIHRoaXMuaWRsZSAqIDEwMDApO1xuICB9XG5cbiAgLypcbiAgICogQWxsb3dzIHByb3RyYWN0b3IgdGVzdHMgdG8gY2FsbCB3YWl0Rm9yQW5ndWxhciB3aXRob3V0IGhhbmdpbmdcbiAgICovXG4gIHNldElkbGVJbnRlcnZhbE91dHNpZGVPZlpvbmUod2F0Y2hGbjogKCkgPT4gdm9pZCwgZnJlcXVlbmN5OiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgdGhpcy5pZGxlSGFuZGxlID0gc2V0SW50ZXJ2YWwod2F0Y2hGbiwgZnJlcXVlbmN5KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qXG4gICAqIFN0b3BzIHdhdGNoaW5nIGZvciBpbmFjdGl2aXR5LlxuICAgKi9cbiAgc3RvcCgpOiB2b2lkIHtcbiAgICB0aGlzLnN0b3BLZWVwYWxpdmUoKTtcblxuICAgIHRoaXMudG9nZ2xlSW50ZXJydXB0cyhmYWxzZSk7XG5cbiAgICB0aGlzLnNhZmVDbGVhckludGVydmFsKCdpZGxlSGFuZGxlJyk7XG4gICAgdGhpcy5zYWZlQ2xlYXJJbnRlcnZhbCgndGltZW91dEhhbmRsZScpO1xuXG4gICAgdGhpcy5zZXRJZGxpbmcoZmFsc2UpO1xuICAgIHRoaXMucnVubmluZyA9IGZhbHNlO1xuXG4gICAgdGhpcy5leHBpcnkubGFzdChudWxsKTtcbiAgfVxuXG4gIC8qXG4gICAqIEZvcmNlcyBhIHRpbWVvdXQgZXZlbnQgYW5kIHN0YXRlLlxuICAgKi9cbiAgdGltZW91dCgpOiB2b2lkIHtcbiAgICB0aGlzLnN0b3BLZWVwYWxpdmUoKTtcblxuICAgIHRoaXMudG9nZ2xlSW50ZXJydXB0cyhmYWxzZSk7XG5cbiAgICB0aGlzLnNhZmVDbGVhckludGVydmFsKCdpZGxlSGFuZGxlJyk7XG4gICAgdGhpcy5zYWZlQ2xlYXJJbnRlcnZhbCgndGltZW91dEhhbmRsZScpO1xuXG4gICAgdGhpcy5zZXRJZGxpbmcodHJ1ZSk7XG4gICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XG4gICAgdGhpcy5jb3VudGRvd24gPSAwO1xuXG4gICAgdGhpcy5vblRpbWVvdXQuZW1pdChudWxsKTtcbiAgfVxuXG4gIC8qXG4gICAqIFNpZ25hbHMgdGhhdCB1c2VyIGFjdGl2aXR5IGhhcyBvY2N1cnJlZC5cbiAgICogQHBhcmFtIGZvcmNlIC0gRm9yY2VzIHdhdGNoIHRvIGJlIGNhbGxlZCwgdW5sZXNzIHRoZXkgYXJlIHRpbWVkIG91dC5cbiAgICogQHBhcmFtIGV2ZW50QXJncyAtIE9wdGlvbmFsIHNvdXJjZSBldmVudCBhcmd1bWVudHMuXG4gICAqL1xuICBpbnRlcnJ1cHQoZm9yY2U/OiBib29sZWFuLCBldmVudEFyZ3M/OiBhbnkpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMucnVubmluZykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnRpbWVvdXRWYWwgJiYgdGhpcy5leHBpcnkuaXNFeHBpcmVkKCkpIHtcbiAgICAgIHRoaXMudGltZW91dCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm9uSW50ZXJydXB0LmVtaXQoZXZlbnRBcmdzKTtcblxuICAgIGlmIChcbiAgICAgIGZvcmNlID09PSB0cnVlIHx8XG4gICAgICB0aGlzLmF1dG9SZXN1bWUgPT09IEF1dG9SZXN1bWUuaWRsZSB8fFxuICAgICAgKHRoaXMuYXV0b1Jlc3VtZSA9PT0gQXV0b1Jlc3VtZS5ub3RJZGxlICYmICF0aGlzLmV4cGlyeS5pZGxpbmcoKSlcbiAgICApIHtcbiAgICAgIHRoaXMud2F0Y2goZm9yY2UpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0SWRsaW5nKHZhbHVlOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5pZGxpbmcgPSB2YWx1ZTtcbiAgICB0aGlzLmV4cGlyeS5pZGxpbmcodmFsdWUpO1xuICB9XG5cbiAgcHJpdmF0ZSB0b2dnbGVTdGF0ZSgpOiB2b2lkIHtcbiAgICB0aGlzLnNldElkbGluZyghdGhpcy5pZGxpbmcpO1xuXG4gICAgaWYgKHRoaXMuaWRsaW5nKSB7XG4gICAgICB0aGlzLm9uSWRsZVN0YXJ0LmVtaXQobnVsbCk7XG4gICAgICB0aGlzLnN0b3BLZWVwYWxpdmUoKTtcblxuICAgICAgaWYgKHRoaXMudGltZW91dFZhbCA+IDApIHtcbiAgICAgICAgdGhpcy5jb3VudGRvd24gPSB0aGlzLnRpbWVvdXRWYWw7XG4gICAgICAgIHRoaXMuZG9Db3VudGRvd24oKTtcbiAgICAgICAgdGhpcy5zZXRUaW1vdXRJbnRlcnZhbE91dHNpZGVab25lKCgpID0+IHtcbiAgICAgICAgICB0aGlzLmRvQ291bnRkb3duSW5ab25lKCk7XG4gICAgICAgIH0sIDEwMDApO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnRvZ2dsZUludGVycnVwdHModHJ1ZSk7XG4gICAgICB0aGlzLm9uSWRsZUVuZC5lbWl0KG51bGwpO1xuICAgICAgdGhpcy5zdGFydEtlZXBhbGl2ZSgpO1xuICAgIH1cblxuICAgIHRoaXMuc2FmZUNsZWFySW50ZXJ2YWwoJ2lkbGVIYW5kbGUnKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0VGltb3V0SW50ZXJ2YWxPdXRzaWRlWm9uZShcbiAgICBpbnRlcnZhbEZuOiAoKSA9PiB2b2lkLFxuICAgIGZyZXF1ZW5jeTogbnVtYmVyXG4gICkge1xuICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICB0aGlzLnRpbWVvdXRIYW5kbGUgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIGludGVydmFsRm4oKTtcbiAgICAgIH0sIGZyZXF1ZW5jeSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHRvZ2dsZUludGVycnVwdHMocmVzdW1lOiBib29sZWFuKTogdm9pZCB7XG4gICAgZm9yIChjb25zdCBpbnRlcnJ1cHQgb2YgdGhpcy5pbnRlcnJ1cHRzKSB7XG4gICAgICBpZiAocmVzdW1lKSB7XG4gICAgICAgIGludGVycnVwdC5yZXN1bWUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGludGVycnVwdC5wYXVzZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0RXhwaXJ5RGlmZih0aW1lb3V0OiBudW1iZXIpOiBudW1iZXIge1xuICAgIGNvbnN0IG5vdzogRGF0ZSA9IHRoaXMuZXhwaXJ5Lm5vdygpO1xuICAgIGNvbnN0IGxhc3Q6IERhdGUgPSB0aGlzLmV4cGlyeS5sYXN0KCkgfHwgbm93O1xuICAgIHJldHVybiBsYXN0LmdldFRpbWUoKSAtIG5vdy5nZXRUaW1lKCkgLSB0aW1lb3V0ICogMTAwMDtcbiAgfVxuXG4gIHByaXZhdGUgZG9Db3VudGRvd25JblpvbmUoKTogdm9pZCB7XG4gICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XG4gICAgICB0aGlzLmRvQ291bnRkb3duKCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGRvQ291bnRkb3duKCk6IHZvaWQge1xuICAgIGNvbnN0IGRpZmYgPSB0aGlzLmdldEV4cGlyeURpZmYodGhpcy50aW1lb3V0VmFsKTtcbiAgICBpZiAoZGlmZiA+IDApIHtcbiAgICAgIHRoaXMuc2FmZUNsZWFySW50ZXJ2YWwoJ3RpbWVvdXRIYW5kbGUnKTtcbiAgICAgIHRoaXMuaW50ZXJydXB0KHRydWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5pZGxpbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jb3VudGRvd24gPD0gMCkge1xuICAgICAgdGhpcy50aW1lb3V0KCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5vblRpbWVvdXRXYXJuaW5nLmVtaXQodGhpcy5jb3VudGRvd24pO1xuICAgIHRoaXMuY291bnRkb3duLS07XG4gIH1cblxuICBwcml2YXRlIHNhZmVDbGVhckludGVydmFsKGhhbmRsZU5hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGhhbmRsZSA9IHRoaXNbaGFuZGxlTmFtZV07XG4gICAgaWYgKGhhbmRsZSAhPT0gbnVsbCAmJiB0eXBlb2YgaGFuZGxlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzW2hhbmRsZU5hbWVdKTtcbiAgICAgIHRoaXNbaGFuZGxlTmFtZV0gPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc3RhcnRLZWVwYWxpdmUoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmtlZXBhbGl2ZVN2YyB8fCAhdGhpcy5rZWVwYWxpdmVFbmFibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucnVubmluZykge1xuICAgICAgdGhpcy5rZWVwYWxpdmVTdmMucGluZygpO1xuICAgIH1cblxuICAgIHRoaXMua2VlcGFsaXZlU3ZjLnN0YXJ0KCk7XG4gIH1cblxuICBwcml2YXRlIHN0b3BLZWVwYWxpdmUoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmtlZXBhbGl2ZVN2YyB8fCAhdGhpcy5rZWVwYWxpdmVFbmFibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5rZWVwYWxpdmVTdmMuc3RvcCgpO1xuICB9XG5cbiAgLypcbiAgICogQ2FsbGVkIGJ5IEFuZ3VsYXIgd2hlbiBkZXN0cm95aW5nIHRoZSBpbnN0YW5jZS5cbiAgICovXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuc3RvcCgpO1xuICAgIHRoaXMuY2xlYXJJbnRlcnJ1cHRzKCk7XG4gIH1cbn1cbiJdfQ==